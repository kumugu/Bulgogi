2025년 3월 10일 작업 내역

1. Entity 설정 오류 수정
- User Entity에 Post 와 관계 설정
- Post Entity 에서 설정한 User author에 대해서 Repository 에서 올바른 명칭으로 변경(findByUser  -> findByIdAuthor 같은 형식으로)

- test시 발생했던 오류들 
```text
java.lang.IllegalStateException: Failed to load ApplicationContext for [WebMergedContextConfiguration@eb6ccbc testClass = com.bulgogi.BulgogiApplicationTests, locations = [], classes = [com.bulgogi.BulgogiApplication], contextInitializerClasses = [], activeProfiles = [], propertySourceDescriptors = [], propertySourceProperties = ["org.springframework.boot.test.context.SpringBootTestContextBootstrapper=true"], contextCustomizers = [org.springframework.boot.test.autoconfigure.OnFailureConditionReportContextCustomizerFactory$OnFailureConditionReportContextCustomizer@53dacd14, org.springframework.boot.test.autoconfigure.actuate.observability.ObservabilityContextCustomizerFactory$DisableObservabilityContextCustomizer@1f, org.springframework.boot.test.autoconfigure.properties.PropertyMappingContextCustomizer@0, org.springframework.boot.test.autoconfigure.web.servlet.WebDriverContextCustomizer@6bea52d4, org.springframework.boot.test.context.filter.ExcludeFilterContextCustomizer@aeab9a1, org.springframework.boot.test.json.DuplicateJsonObjectContextCustomizerFactory$DuplicateJsonObjectContextCustomizer@72ea6193, org.springframework.boot.test.mock.mockito.MockitoContextCustomizer@0, org.springframework.boot.test.web.client.TestRestTemplateContextCustomizer@75b25825, org.springframework.boot.test.web.reactor.netty.DisableReactorResourceFactoryGlobalResourcesContextCustomizerFactory$DisableReactorResourceFactoryGlobalResourcesContextCustomizerCustomizer@6035b93b, org.springframework.test.context.support.DynamicPropertiesContextCustomizer@0, org.springframework.boot.test.context.SpringBootTestAnnotation@3a75cc75], resourceBasePath = "src/main/webapp", contextLoader = org.springframework.boot.test.context.SpringBootContextLoader, parent = null]

Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is org.hibernate.MappingException: Column 'user_id' is duplicated in mapping for entity 'com.bulgogi.blog.model.Post' (use '@Column(insertable=false, updatable=false)' when mapping multiple properties to the same column)

Caused by: jakarta.persistence.PersistenceException: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is org.hibernate.MappingException: Column 'user_id' is duplicated in mapping for entity 'com.bulgogi.blog.model.Post' (use '@Column(insertable=false, updatable=false)' when mapping multiple properties to the same column)

Caused by: org.hibernate.MappingException: Column 'user_id' is duplicated in mapping for entity 'com.bulgogi.blog.model.Post' (use '@Column(insertable=false, updatable=false)' when mapping multiple properties to the same column)
	at org.hibernate.mapping.Value.checkColumnDuplication(Value.java:196)
	at org.hibernate.mapping.MappingHelper.checkPropertyColumnDuplication(MappingHelper.java:251)
	at org.hibernate.mapping.PersistentClass.checkColumnDuplication(PersistentClass.java:941)
	at org.hibernate.mapping.PersistentClass.validate(PersistentClass.java:696)
	at org.hibernate.mapping.RootClass.validate(RootClass.java:286)
	at org.hibernate.boot.internal.MetadataImpl.validate(MetadataImpl.java:505)
	at org.hibernate.internal.SessionFactoryImpl.<init>(SessionFactoryImpl.java:282)
	at org.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:463)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1517)

Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is org.hibernate.MappingException: Column 'user_id' is duplicated in mapping for entity 'com.bulgogi.blog.model.Post' (use '@Column(insertable=false, updatable=false)' when mapping multiple properties to the same column)
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is org.hibernate.MappingException: Column 'user_id' is duplicated in mapping for entity 'com.bulgogi.blog.model.Post' (use '@Column(insertable=false, updatable=false)' when mapping multiple properties to the same column)
Caused by: jakarta.persistence.PersistenceException: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is org.hibernate.MappingException: Column 'user_id' is duplicated in mapping for entity 'com.bulgogi.blog.model.Post' (use '@Column(insertable=false, updatable=false)' when mapping multiple properties to the same column)
Caused by: org.hibernate.MappingException: Column 'user_id' is duplicated in mapping for entity 'com.bulgogi.blog.model.Post' (use '@Column(insertable=false, updatable=false)' when mapping multiple properties to the same column)
	at app//org.hibernate.mapping.Value.checkColumnDuplication(Value.java:196)
	at app//org.hibernate.mapping.MappingHelper.checkPropertyColumnDuplication(MappingHelper.java:251)
	at app//org.hibernate.mapping.PersistentClass.checkColumnDuplication(PersistentClass.java:941)
	at app//org.hibernate.mapping.PersistentClass.validate(PersistentClass.java:696)
	at app//org.hibernate.mapping.RootClass.validate(RootClass.java:286)
	at app//org.hibernate.boot.internal.MetadataImpl.validate(MetadataImpl.java:505)
	at app//org.hibernate.internal.SessionFactoryImpl.<init>(SessionFactoryImpl.java:282)
	at app//org.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:463)
	at app//org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1517)
```



2. Post CRUD 기능 구현
- tag API 완료
- category API  완료


- Post Create 문제

Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'categoryController' defined in file [C:\workspace\Bulgogi\bulgogi_be\build\classes\java\main\com\bulgogi\blog\controller\CategoryController.class]: Unsatisfied dependency expressed through constructor parameter 1: Error creating bean with name 'postService' defined in file [C:\workspace\Bulgogi\bulgogi_be\build\classes\java\main\com\bulgogi\blog\service\PostService.class]: null
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'postService' defined in file [C:\workspace\Bulgogi\bulgogi_be\build\classes\java\main\com\bulgogi\blog\service\PostService.class]: null
Caused by: java.lang.ClassCastException: class ch.qos.logback.classic.Logger cannot be cast to class java.util.logging.Logger (ch.qos.logback.classic.Logger is in unnamed module of loader 'app'; java.util.logging.Logger is in module java.logging of loader 'bootstrap')
	at com.bulgogi.blog.service.PostService.<clinit>(PostService.java:38)

Error creating bean with name 'categoryController' defined in file [C:\workspace\Bulgogi\bulgogi_be\build\classes\java\main\com\bulgogi\blog\controller\CategoryController.class]: Unsatisfied dependency expressed through constructor parameter 1: Error creating bean with name 'postService' defined in file [C:\workspace\Bulgogi\bulgogi_be\build\classes\java\main\com\bulgogi\blog\service\PostService.class]: null
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'categoryController' defined in file [C:\workspace\Bulgogi\bulgogi_be\build\classes\java\main\com\bulgogi\blog\controller\CategoryController.class]: Unsatisfied dependency expressed through constructor parameter 1: Error creating bean with name 'postService' defined in file [C:\workspace\Bulgogi\bulgogi_be\build\classes\java\main\com\bulgogi\blog\service\PostService.class]: null
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'postService' defined in file [C:\workspace\Bulgogi\bulgogi_be\build\classes\java\main\com\bulgogi\blog\service\PostService.class]: null
Caused by: java.lang.ClassCastException: class ch.qos.logback.classic.Logger cannot be cast to class java.util.logging.Logger (ch.qos.logback.classic.Logger is in unnamed module of loader 'app'; java.util.logging.Logger is in module java.logging of loader 'bootstrap')


- jwt payload에 username을 추가하기로 함


- postService 수정 필요
025-03-10T19:44:23.780+09:00  INFO 3264 --- [nio-8080-exec-2] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-03-10T19:44:23.780+09:00  INFO 3264 --- [nio-8080-exec-2] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-03-10T19:44:23.781+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.web.servlet.DispatcherServlet        : Detected StandardServletMultipartResolver
2025-03-10T19:44:23.781+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.web.servlet.DispatcherServlet        : Detected AcceptHeaderLocaleResolver
2025-03-10T19:44:23.781+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.web.servlet.DispatcherServlet        : Detected FixedThemeResolver
2025-03-10T19:44:23.781+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.web.servlet.DispatcherServlet
        : Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@ad038f8
2025-03-10T19:44:23.781+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.web.servlet.DispatcherServlet        : Detected org.springframework.web.servlet.support.SessionFlashMapManager@4ba64e36      
2025-03-10T19:44:23.782+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.web.servlet.DispatcherServlet
        : enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-03-10T19:44:23.782+09:00  INFO 3264 --- [nio-8080-exec-2] o.s.web.servlet.DispatcherServlet        : Completed initialization in 2 ms
2025-03-10T19:44:23.796+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.security.web.FilterChainProxy        : Securing POST /api/posts/2
2025-03-10T19:44:23.856+09:00 DEBUG 3264 --- [nio-8080-exec-2] tor$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
Hibernate: select u1_0.id,u1_0.bio,u1_0.created_at,u1_0.deleted,u1_0.email,u1_0.password,u1_0.profile_image,u1_0.role,u1_0.updated_at,u1_0.username from users u1_0 where u1_0.username=?
2025-03-10T19:44:23.954+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.security.web.FilterChainProxy        : Secured POST /api/posts/2
2025-03-10T19:44:23.956+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.web.servlet.DispatcherServlet        : POST "/api/posts/2", parameters={}
2025-03-10T19:44:23.958+09:00 DEBUG 3264 --- [nio-8080-exec-2] s.w.s.m.m.a.RequestMappingHandler
Mapping : Mapped to com.bulgogi.blog.controller.PostController#createPost(PostRequestDTO, UserDetails)
2025-03-10T19:44:24.001+09:00 DEBUG 3264 --- [nio-8080-exec-2] m.m.a.RequestResponseBodyMethodProcessor : Read "application/json;charset=UTF-8" to [com.bulgogi.blog.dto.PostRequestDTO@1c1dd3c1]
현재 인증된 사용자 이름: asdf2
2025-03-10T19:44:24.007+09:00 DEBUG 3264 --- [nio-8080-exec-2] tor$SharedEntityManagerInvocationHandler : Creating new EntityManager for shared EntityManager invocation
Hibernate: select u1_0.id,u1_0.bio,u1_0.created_at,u1_0.deleted,u1_0.email,u1_0.password,u1_0.profile_image,u1_0.role,u1_0.updated_at,u1_0.username from users u1_0 where u1_0.username=?       
2025-03-10T19:44:24.012+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.orm.jpa.JpaTransactionManager
        : Creating new transaction with name [com.bulgogi.blog.service.PostService.createPost]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-03-10T19:44:24.013+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.orm.jpa.JpaTransactionManager        : Opened new EntityManager [SessionImpl(1357544864<open>)] for JPA transaction
2025-03-10T19:44:24.016+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.orm.jpa.JpaTransactionManager
        : Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4d7bf1e6]
2025-03-10T19:44:24.017+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.orm.jpa.JpaTransactionManager        : Found thread-bound EntityManager [SessionImpl(1357544864<open>)] for JPA transaction  
2025-03-10T19:44:24.017+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.orm.jpa.JpaTransactionManager        : Participating in existing transaction
Hibernate: select u1_0.id,u1_0.bio,u1_0.created_at,u1_0.deleted,u1_0.email,u1_0.password,u1_0.profile_image,u1_0.role,u1_0.updated_at,u1_0.username from users u1_0 where u1_0.id=?
2025-03-10T19:44:24.026+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.orm.jpa.JpaTransactionManager        : Found thread-bound EntityManager [SessionImpl(1357544864<open>)] for JPA transaction  
2025-03-10T19:44:24.114+09:00 ERROR 3264 --- [nio-8080-exec-2] o.h.engine.jdbc.spi.SqlExceptionHelper   : Column 'user_id' cannot be null
2025-03-10T19:44:24.117+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.orm.jpa.JpaTransactionManager        : Participating transaction failed - marking existing transaction as rollback-only
2025-03-10T19:44:24.117+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.orm.jpa.JpaTransactionManager        : Setting JPA transaction on EntityManager [SessionImpl(1357544864<open>)] rollback-only2025-03-10T19:44:24.119+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.orm.jpa.JpaTransactionManager        : Initiating transaction rollback
2025-03-10T19:44:24.119+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.orm.jpa.JpaTransactionManager        : Rolling back JPA transaction on EntityManager [SessionImpl(1357544864<open>)]
2025-03-10T19:44:24.121+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.orm.jpa.JpaTransactionManager        : Closing JPA EntityManager [SessionImpl(1357544864<open>)] after transaction
2025-03-10T19:44:24.122+09:00 DEBUG 3264 --- [nio-8080-exec-2] .m.m.a.ExceptionHandlerExceptionResolver : Using @ExceptionHandler com.bulgogi.user.exception.GlobalExceptionHandler#handleGeneralException(Exception, HttpServletRequest)
2025-03-10T19:44:24.130+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.w.s.m.m.a.HttpEntityMethodProcessor  : Using 'application/json', given [*/*] and supported [application/json, application/*+json]      
2025-03-10T19:44:24.131+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.w.s.m.m.a.HttpEntityMethodProcessor  : Writing [{path=/api/posts/2, error=Internal Server Error, message=서버 내부 오류가 발생했습니다.025-03-10T19: (truncated)...]
2025-03-10T19:44:24.145+09:00 DEBUG 3264 --- [nio-8080-exec-2] .m.m.a.ExceptionHandlerExceptionResolver : Resolved [java.lang.RuntimeException: 사용자 ID 또는 게시글 작성에 문제가 발생했습니다: could no[Column 'user_id' cannot be null] [insert into posts (user_id,category_id,content,created_at,published,title,updated_at,views) values (?,?,?,?,?,?,?,?)]; SQL [insert into posts (user_id,category_id,content,created_at,published,title,updated_at,views) values (?,?,?,?,?,?,?,?)]; constraint [null]]
2025-03-10T19:44:24.145+09:00 DEBUG 3264 --- [nio-8080-exec-2] o.s.web.servlet.DispatcherServlet        : Completed 500 INTERNAL_SERVER_ERROR
<==========---> 80% EXECUTING [24s]
> :bootRun



















